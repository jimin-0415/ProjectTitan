/**********************************************************************************************************************
* @file  SendBufferChunk.cpp
*
* @brief SendBufferChunk 클래스 cpp 파일
*
* @date  2025.03.03
**********************************************************************************************************************/


#include "pch.h"
#include "SendBufferChunk.h"
#include "SendBuffer.h"


/**********************************************************************************************************************
* @brief 생성자
**********************************************************************************************************************/
SendBufferChunk::SendBufferChunk()
{
}

/**********************************************************************************************************************
* @brief 소멸자
**********************************************************************************************************************/
SendBufferChunk::~SendBufferChunk()
{
}

/**********************************************************************************************************************
* @brief 초기상태로 되돌린다
**********************************************************************************************************************/
ExVoid SendBufferChunk::Reset()
{
    _open = false;
    _usedSize = 0;
}

/**********************************************************************************************************************
* @brief 버퍼를 연다
**********************************************************************************************************************/
SendBufferPtr SendBufferChunk::Open( ExUInt32 allocSize )
{
    ASSERT_CRASH( allocSize <= ChunkSize );
    ASSERT_CRASH( false == _open );

    if ( allocSize > FreeSize() )
        return nullptr;

    _open = true;
    
    return std::make_shared< SendBuffer >( shared_from_this(), Buffer(), allocSize );
}

/**********************************************************************************************************************
* @brief 버퍼를 닫는다
**********************************************************************************************************************/
ExVoid SendBufferChunk::Close( ExUInt32 writeSize )
{
    ASSERT_CRASH( true == _open );
    _open = false;
    _usedSize += writeSize;
}
