/**********************************************************************************************************************
* @file  Service.cpp
*
* @brief Service 클래스 cpp 파일
*
* @date  2025.02.28
**********************************************************************************************************************/


#include "pch.h"
#include "Service.h"
#include "Session.h"
#include "Listener.h"


/**********************************************************************************************************************
* @brief 생성자
**********************************************************************************************************************/
Service::Service(
    EServiceType   type,
    NetAddress     netAddress,
    IocpCorePtr    iocpCore,
    SessionFactory sessionFactory,
    ExInt32        maxSessionCount )
:
_type           ( type            ),
_netAddress     ( netAddress      ),
_iocpCore       ( iocpCore        ),
_sessionFactory ( sessionFactory  ),
_maxSessionCount( maxSessionCount )
{
}

/**********************************************************************************************************************
* @brief 소멸자
**********************************************************************************************************************/
Service::~Service()
{
}

/**********************************************************************************************************************
* @brief 시작한다.
**********************************************************************************************************************/
ExBool Service::Start()
{
    return ExBool();
}

/**********************************************************************************************************************
* @brief 서비스를 종료한다.
**********************************************************************************************************************/
ExVoid Service::CloseService()
{
    // TODO
}

/**********************************************************************************************************************
* @brief 세션을 생성한다.
**********************************************************************************************************************/
SessionPtr Service::CreateSession()
{
    SessionPtr session = _sessionFactory();

    if ( _iocpCore->Register( session ) == false )
        return nullptr;

    return session;
}

/**********************************************************************************************************************
* @brief 세션을 추가한다.
**********************************************************************************************************************/
ExVoid Service::AddSession( SessionPtr session )
{
    WRITE_LOCK;
    _sessionCount++;
    _sessions.insert( session );
}

/**********************************************************************************************************************
* @brief 세션을 해제한다.
**********************************************************************************************************************/
ExVoid Service::ReleaseSession( SessionPtr session )
{
    WRITE_LOCK;
    ASSERT_CRASH( _sessions.erase( session ) != 0 );
    _sessionCount--;
}
